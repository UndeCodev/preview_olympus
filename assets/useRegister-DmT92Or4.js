import{p as o,q as f,s as y,x as I,y as M}from"./index-BWcMTDfT.js";import{o as v}from"./olympusAPI-Dwh3OM0h.js";const O=()=>{const t=o(!1),p=o(!1),d=o(""),w=o(0),m=o(!0),n=o(!1),l=o(0),c=f({email:"",password:""}),s=f({name:"Diego Vite",phone:"7713400653",emailR:"jekofel661@rowplant.com",password:"Masterv123@1",confirmPassword:"Masterv123@1"}),$={name:{$autoDirty:!0,required:helpers.withMessage("Este campo es obligatorio",required),alphaWithSpaces:helpers.withMessage("Solo debe de contener letras",alphaWithSpaces)},phone:{$autoDirty:!0,required:helpers.withMessage("Este campo es obligatorio",required),numeric:helpers.withMessage("Solo se permiten n√∫meros",numeric)},emailR:{$autoDirty:!0,required:helpers.withMessage("Este campo es obligatorio",required),email:helpers.withMessage("Debe ser un email v√°lido",email)},password:{$autoDirty:!0,required:helpers.withMessage("Este campo es obligatorio",required),passwordRegex:helpers.withMessage("No cumple con los requisitos m√≠nimos",passwordRegex),isPasswordWeak:helpers.withMessage("Contrase√±a altamente d√©bil.",isPasswordWeak)},confirmPassword:{$autoDirty:!0,required:helpers.withMessage("Este campo es obligatorio",required),sameAs:helpers.withMessage("Las contrase√±as no coinciden",sameAs(y(()=>s.password)))}},q={email:{$autoDirty:!0,required:helpers.withMessage("Este campo es obligatorio",required),email:helpers.withMessage("Correo electr√≥nico inv√°lido",email)},password:{$autoDirty:!0,required:helpers.withMessage("Este campo es obligatorio",required)}},i=I.useToast(),u=useVuelidate($,s),h=useVuelidate(q,c),k=()=>{const e=s.password;checks.value.lowercaseUppercase=/[a-z]/.test(e)&&/[A-Z]/.test(e),checks.value.number=/\d/.test(e),checks.value.specialChar=/[!@#$%^&*]/.test(e),checks.value.minLength=e.length>=12;const a=Object.values(checks.value).filter(Boolean).length;w.value=a/4*100},b=()=>{p.value=!p.value},R=async()=>{if(!(!s.password||s.password.length<12||u.value.password.$error))try{const a=(await v.post("/check-pswd",{password:s.password})).data==="Comprometida";d.value=a?"Contrase√±a comprometida, por favor utiliza otra.":""}catch(e){console.error("Error verificando la contrase√±a:",e),d.value="Error verificando la contrase√±a"}},P=y(()=>{const e=Math.floor(l.value),a=Math.floor(e/60),r=e%60;return`${a}:${r<10?"0"+r:r}`}),E=()=>{const e=setInterval(()=>{l.value>0?l.value--:(clearInterval(e),n.value=!1)},1e3)},D=async()=>{if(h.value.$touch(),h.value.$invalid)return;const a=await grecaptcha.getResponse();if(!a)return m.value=!1;try{t.value=!0,m.value=!0;const{data:r}=await v.post("/login",{email:c.email,password:c.password,tokenCaptcha:a});t.value=!1,localStorage.setItem("token",r.token);const g=localStorage.getItem("last-path")??"/";M.replace(g),i.open({message:"Bienvenido de nuevo! üëãüèΩüëãüèΩüëãüèΩ",type:"success",duration:4e3,pauseOnHover:!0})}catch(r){t.value=!1,grecaptcha.reset();const g=r.response.data.message;r.response.status===403&&!n.value&&(l.value=r.response.data.timeRemaining,E(),n.value=!0),i.open({message:`${g}`,type:"error",duration:4e3,pauseOnHover:!0,queue:!0})}},C=async()=>{if(u.value.$touch(),!u.value.$invalid)try{if(t.value=!0,(await v.post("/register",{nombre:s.name,email:s.emailR,telefono:s.phone,password:s.password})).status!=201)throw new Error;t.value=!1,i.open({message:"Usuario creado correctamente! üéâüéâüéâ",type:"success",duration:4e3,pauseOnHover:!0,queue:!0}),setTimeout(()=>{i.open({message:"Ahora puedes iniciar sesi√≥n",type:"info",duration:4e3,pauseOnHover:!0}),M.replace({name:"inicio-sesion"})},2e3)}catch(a){t.value=!1;const r=a.response.data.message;i.open({message:`${r}`,type:"error",duration:6e3,pauseOnHover:!0,queue:!0})}};return{loginData:c,formRegister:s,strengthPercent:w,checks,isPasswordVisible:p,isLoading:t,isCaptchaVerified:m,passwordStatus:d,isLocked:n,v$:u,v$Login:h,formattedTime:P,togglePasswordVisibility:b,checkPasswordStrength:k,checkPassword:R,onRegister:C,onLogin:D}};export{O as u};
