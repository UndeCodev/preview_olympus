import{a as S,C as T,b as L,d as v,e as F,u as I,f as N,g as n,h as s,w as y,v as j,n as $,i as o,F as b,j as C,k as f,l as _,m as M,p as z,c as V,q as u,t as k,s as D,x as H,r as O,o as a,y as P}from"./index-CSTKgCyW.js";import{c as h,r as B,e as U,u as K}from"./index-DIE5a-PX.js";import{r as Y}from"./EyeIcon-CgvG_yKu.js";import{r as G}from"./EyeSlashIcon-Bq_phEcF.js";const J={class:"container mx-auto h-screen grid content-center place-content-center"},Q={class:"form-group grid gap-3"},W={key:0},X={class:"form-group grid gap-3"},Z={for:"password",class:"flex justify-between"},ee={class:"password-container"},se=["type"],te={key:0},oe={key:0},ae={class:"text-center text-error"},re={class:"recaptcha"},ne={key:0,class:"text-error"},ie={class:"btn btn-primary"},le={key:0},de={key:1,class:"sk-chase w-8 h-8 mx-auto"},ue={class:"grid text-center"},ge={__name:"LoginView",setup(ce){S(()=>{window.grecaptcha.render("recaptcha",{sitekey:T,"expired-callback":()=>{console.log("Expirado")}})});const d=L({email:"",password:""}),g=v(!0),w=v(!1),c=v(0),p=v(!1),q={email:{required:h.withMessage("Este campo es obligatorio",B),email:h.withMessage("Correo electrónico inválido",U)},password:{required:h.withMessage("Este campo es obligatorio",B)}},r=K(q,d),x=F.useToast(),m=I(),A=N(()=>{const i=Math.floor(c.value),e=Math.floor(i/60),l=i%60;return`${e}:${l<10?"0"+l:l}`}),E=()=>{const i=setInterval(()=>{c.value>0?c.value--:(clearInterval(i),w.value=!1)},1e3)},R=async()=>{if(r.value.$touch(),r.value.$invalid)return;const i=await grecaptcha.getResponse();if(!i)return g.value=!1;g.value=!0;const{ok:e,message:l,timeRemaining:t}=await m.login(d.email,d.password,i);if(!e){grecaptcha.reset(),t>0&&(c.value=t,w.value=!0,E()),x.open({message:l,type:"error",duration:4e3,pauseOnHover:!0});return}P.replace({name:m.hasMFA?"mfa-verification":"inicio"}),m.hasMFA||x.open({message:"Bienvenido de nuevo 👋🏽👋🏽👋🏽",type:"success",duration:4e3,pauseOnHover:!0})};return(i,e)=>{const l=O("RouterLink");return a(),n("main",J,[s("form",{onSubmit:H(R,["prevent"]),class:"form bg-white rounded-md shadow-md p-6"},[e[14]||(e[14]=s("h1",{class:"text-center text-4xl"},"Iniciar sesión",-1)),s("div",Q,[e[5]||(e[5]=s("label",{for:"email"},"Correo electrónico:",-1)),y(s("input",{type:"text",placeholder:"janedoe@outlook.com",class:$(["form-control",{"form-control--error":o(r).email.$error}]),id:"email","onUpdate:modelValue":e[0]||(e[0]=t=>d.email=t),onBlur:e[1]||(e[1]=(...t)=>o(r).email.$touch&&o(r).email.$touch(...t))},null,34),[[j,d.email,void 0,{trim:!0}]]),o(r).email.$error?(a(),n("span",W,[(a(!0),n(b,null,C(o(r).email.$errors,t=>(a(),n("p",{key:t.$uid,class:"text-error"},k(t.$message),1))),128))])):f("",!0)]),e[15]||(e[15]=s("input",{type:"text",name:"username",autocomplete:"username",style:{display:"none"}},null,-1)),s("div",X,[s("label",Z,[e[7]||(e[7]=s("span",null,"Contraseña: ",-1)),_(l,{class:"text-link",to:{name:"enviar-correo-recuperacion"}},{default:M(()=>e[6]||(e[6]=[u(" ¿Olvidaste tu contraseña? ")])),_:1})]),s("div",ee,[y(s("input",{type:p.value?"text":"password",placeholder:"**********",class:$(["form-control",{"form-control--error":o(r).password.$error}]),id:"password","onUpdate:modelValue":e[2]||(e[2]=t=>d.password=t),onBlur:e[3]||(e[3]=(...t)=>o(r).password.$touch&&o(r).password.$touch(...t)),autocomplete:"current-password"},null,42,se),[[z,d.password]]),s("button",{type:"button",onClick:e[4]||(e[4]=t=>p.value=!p.value),class:"toggle-btn bg-blue-100"},[p.value?(a(),V(o(G),{key:1,class:"icon-password size-8"})):(a(),V(o(Y),{key:0,class:"icon-password size-8"}))])]),o(r).password.$error?(a(),n("span",te,[(a(!0),n(b,null,C(o(r).password.$errors,t=>(a(),n("p",{key:t.$uid,class:"text-error"},k(t.$message),1))),128))])):f("",!0)]),w.value?(a(),n("div",oe,[s("p",ae,[e[8]||(e[8]=u(" Cuenta bloqueada temporalmente. ")),e[9]||(e[9]=s("br",null,null,-1)),u(" Tiempo restante: "+k(A.value),1)])])):f("",!0),s("div",re,[e[10]||(e[10]=s("div",{class:"recaptcha",id:"recaptcha"},null,-1)),g.value?f("",!0):(a(),n("p",ne," Por favor, verifica que no eres un robot. "))]),s("button",ie,[o(m).isChecking?(a(),n("div",de,e[11]||(e[11]=[D('<div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div>',6)]))):(a(),n("span",le,"Iniciar sesión"))]),s("span",ue,[e[13]||(e[13]=u("¿Aún no tienes una cuenta? ")),_(l,{class:"text-link",to:{name:"registro"}},{default:M(()=>e[12]||(e[12]=[u("Registrate aquí")])),_:1})])],32)])}}};export{ge as default};
