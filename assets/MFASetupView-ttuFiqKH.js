import{o as s,g as o,h as a,_ as I,u as E,d as u,e as q,f as B,a as H,i as p,l as _,t as V,q as v,s as $,F as O,j as P,x,B as f,w as L,v as N,H as T}from"./index-4I1gUxWq.js";function j(g,n){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"})])}function z(g,n){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})])}function K(g,n){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"fill-rule":"evenodd",d:"M2 8a.75.75 0 0 1 .75-.75h8.69L8.22 4.03a.75.75 0 0 1 1.06-1.06l4.5 4.5a.75.75 0 0 1 0 1.06l-4.5 4.5a.75.75 0 0 1-1.06-1.06l3.22-3.22H2.75A.75.75 0 0 1 2 8Z","clip-rule":"evenodd"})])}const Z={key:0,class:"h-screen grid place-items-center"},G={class:"bg-white grid gap-12 rounded-xl p-8 lg:w-1/4"},U={class:"bg-blue-50 rounded-full w-36 h-36 flex place-items-center place-content-center mx-auto"},Q={key:1,class:"h-screen grid place-content-center"},R={key:0,class:"mfa"},J={class:"mfa__information"},W={class:"mfa__title text-5xl text-center mb-4 font-bold"},X=["src"],Y={key:1,class:"sk-chase w-24 h-24 mx-auto"},ee={key:1,class:"bg-white rounded-md shadow-sm p-8 grid place-items-center gap-12"},te={class:"flex space-x-5"},ae=["onUpdate:modelValue","onInput","onKeydown"],se={class:"flex gap-6"},oe=["disabled"],ne={__name:"MFASetupView",setup(g){const n=E(),m=u(!1),h=u(""),y=u(""),c=u(["","","","","",""]),d=q.useToast(),b=B(()=>c.value.join("")),w=u(!1),k=async()=>{try{m.value=!0;const t=await f.post("/auth/mfa/setup",{email:n.email});h.value=t.data.qrCode,y.value=t.data.secret,m.value=!1}catch(t){m.value=!1,console.error("Error configurando MFA:",t)}},A=async()=>{if(b.value.length)try{await f.post("/auth/mfa/verify",{token:b.value,secret:y.value}),await M(),n.user.hasMFA=!0}catch(t){const e=t.response.data.message;d.open({message:e,type:"error",duration:4e3,pauseOnHover:!0})}},M=async()=>{try{await f.put("/auth/mfa/enable",{userId:n.userId,mfaState:!0}),d.open({message:"Enhorabuena, configuraste correctamente la seguridad de dos pasos! 🎉🎉🎉",type:"success",duration:4e3,pauseOnHover:!0})}catch(t){const e=t.response.data.message;d.open({message:e,type:"error",duration:4e3,pauseOnHover:!0})}},C=async()=>{if(confirm("¿Estás seguro de querer deshabilitar la autenticación de dos pasos?"))try{await f.put("/auth/mfa/enable",{userId:n.userId,mfaState:!1}),d.open({message:"Se ha desactivado correctamente la autenticación de dos pasos de tu cuenta.",type:"info",duration:4e3,pauseOnHover:!0}),n.user.hasMFA=!1}catch(e){const l=e.response.data.message;d.open({message:l,type:"error",duration:4e3,pauseOnHover:!0})}},F=(t,e)=>{e.target.value.length===1&&t<c.value.length-1&&document.querySelectorAll("input")[t+1].focus()},S=t=>{c.value[t]===""&&t>0&&document.querySelectorAll("input")[t-1].focus()},D=t=>{const l=t.clipboardData.getData("text").split("").slice(0,6);l.forEach((i,r)=>{c.value[r]=i||""}),document.querySelectorAll("input")[l.length-1].focus(),t.preventDefault()};return H(async()=>{await k()}),(t,e)=>p(n).hasMFA?(s(),o("div",Z,[a("div",G,[a("div",U,[_(p(j),{class:"size-28 text-blue-400"})]),e[3]||(e[3]=a("p",{class:"text-gray-900 mb-4 text-center text-4xl font-serif"}," Tienes activada la autenticación de dos factores para mayor seguridad en tu cuenta. ",-1)),a("button",{onClick:C,class:"btn btn-primary"},"Deshabilitar MFA")])])):(s(),o("div",Q,[w.value?(s(),o("form",ee,[e[8]||(e[8]=a("div",{class:"grid gap-3"},[a("h1",{class:"mfa__title text-5xl text-center font-bold"}," Confirma el Código de Autenticación "),a("h2",{class:"mfa__subtitle text-center"}," Introduce el código de 6 dígitos generado en la app de autenticación. ")],-1)),a("div",te,[(s(!0),o(O,null,P(c.value,(l,i)=>L((s(),o("input",{key:i,type:"text",class:"border rounded text-center w-10",maxlength:"1","onUpdate:modelValue":r=>c.value[i]=r,onInput:r=>F(i,r),onPaste:e[1]||(e[1]=r=>D(r)),onKeydown:T(r=>S(i),["backspace"])},null,40,ae)),[[N,c.value[i]]])),128))]),a("div",se,[a("button",{class:"btn btn-outline flex place-content-center place-items-center gap-2",onClick:e[2]||(e[2]=x(l=>w.value=!1,["prevent"]))},[_(p(z),{class:"size-7"}),e[7]||(e[7]=v("Paso anterior "))]),a("button",{class:"btn btn-primary flex place-content-center place-items-center disabled:opacity-75 disabled:cursor-not-allowed disabled:hover:text-white",disabled:b.value.length<6,onClick:x(A,["prevent"])}," Completar verificación de 2 pasos ",8,oe)])])):(s(),o("div",R,[a("div",J,[a("h1",W," Protege tu cuenta con la verificación en dos pasos "+V(p(n).hasEnableMFA),1),e[4]||(e[4]=a("h2",{class:"mfa__subtitle text-center"},[v(" 1. Abre tu aplicación de autenticación (Google Authenticator, Authy, etc.). "),a("br"),v(" 2. Selecciona la opción para escanear un código QR. ")],-1))]),h.value?(s(),o("img",{key:0,src:h.value,alt:"Escanea este código con Google Authenticator",class:"mfa__qr shadow-sm rounded-sm"},null,8,X)):(s(),o("div",Y,e[5]||(e[5]=[$('<div class="sk-chase-dot before:bg-slate-900" data-v-a7e09b12></div><div class="sk-chase-dot before:bg-slate-900" data-v-a7e09b12></div><div class="sk-chase-dot before:bg-slate-900" data-v-a7e09b12></div><div class="sk-chase-dot before:bg-slate-900" data-v-a7e09b12></div><div class="sk-chase-dot before:bg-slate-900" data-v-a7e09b12></div><div class="sk-chase-dot before:bg-slate-900" data-v-a7e09b12></div>',6)]))),a("button",{class:"btn btn-primary w-2/3 flex place-content-center place-items-center gap-2",onClick:e[0]||(e[0]=l=>w.value=!0)},[e[6]||(e[6]=v(" Continuar ")),_(p(K),{class:"size-7"})])]))]))}},ce=I(ne,[["__scopeId","data-v-a7e09b12"]]);export{ce as default};
