import{b as E,C as R,d as S,e as f,f as T,u as L,g as A,c as r,h as t,w as x,v as $,n as y,i as a,F as C,j as b,k as c,l as m,t as g,m as I,a as N,p as F,q as H,r as j,o as i,s as D}from"./index-DFWwSDKG.js";import{c as k,r as _,e as O,u as P}from"./index-mbDTybGK.js";const U={class:"form-group grid gap-3"},z={key:0},K={class:"form-group grid gap-3"},Y={class:"password-container"},G={key:0},J={key:0},Q={class:"text-center text-error"},W={class:"recaptcha"},X={key:0,class:"text-error"},Z={class:"btn btn-primary"},ee={key:0},se={key:1,class:"sk-chase w-8 h-8 mx-auto"},te={class:"grid text-center"},ie={__name:"LoginView",setup(oe){E(()=>{window.grecaptcha.render("recaptcha",{sitekey:R,"expired-callback":()=>{console.log("Expirado")}})});const n=S({email:"",password:""}),p=f(!0),v=f(!1),u=f(0),V={email:{required:k.withMessage("Este campo es obligatorio",_),email:k.withMessage("Correo electrónico inválido",O)},password:{required:k.withMessage("Este campo es obligatorio",_)}},o=P(V,n),w=T.useToast(),h=L(),q=A(()=>{const l=Math.floor(u.value),e=Math.floor(l/60),d=l%60;return`${e}:${d<10?"0"+d:d}`}),M=()=>{const l=setInterval(()=>{u.value>0?u.value--:(clearInterval(l),v.value=!1)},1e3)},B=async()=>{if(o.value.$touch(),o.value.$invalid)return;const l=await grecaptcha.getResponse();if(!l)return p.value=!1;p.value=!0;const{ok:e,message:d,timeRemaining:s}=await h.login(n.email,n.password,l);if(!e){grecaptcha.reset(),s>0&&(u.value=s,v.value=!0,M()),w.open({message:d,type:"error",duration:4e3,pauseOnHover:!0});return}D.replace({name:"mfa",query:{email:n.email}}),w.open({message:"Bienvenido de nuevo 👋🏽👋🏽👋🏽",type:"success",duration:4e3,pauseOnHover:!0})};return(l,e)=>{const d=j("RouterLink");return i(),r("form",{onSubmit:H(B,["prevent"]),class:"form bg-white rounded-sm shadow-sm p-6"},[e[12]||(e[12]=t("h1",{class:"text-center text-4xl"},"Iniciar sesión",-1)),t("div",U,[e[4]||(e[4]=t("label",{for:"email"},"Correo electrónico:",-1)),x(t("input",{type:"text",placeholder:"janedoe@outlook.com",class:y(["form-control",{"form-control--error":a(o).email.$error}]),id:"email","onUpdate:modelValue":e[0]||(e[0]=s=>n.email=s),onBlur:e[1]||(e[1]=(...s)=>a(o).email.$touch&&a(o).email.$touch(...s))},null,34),[[$,n.email,void 0,{trim:!0}]]),a(o).email.$error?(i(),r("span",z,[(i(!0),r(C,null,b(a(o).email.$errors,s=>(i(),r("p",{key:s.$uid,class:"text-error"},g(s.$message),1))),128))])):c("",!0)]),t("div",K,[e[5]||(e[5]=t("label",{for:"password"},"Contraseña:",-1)),t("div",Y,[x(t("input",{placeholder:"**********",class:y(["form-control",{"form-control--error":a(o).password.$error}]),id:"password","onUpdate:modelValue":e[2]||(e[2]=s=>n.password=s),onBlur:e[3]||(e[3]=(...s)=>a(o).password.$touch&&a(o).password.$touch(...s))},null,34),[[$,n.password]])]),a(o).password.$error?(i(),r("span",G,[(i(!0),r(C,null,b(a(o).password.$errors,s=>(i(),r("p",{key:s.$uid,class:"text-error"},g(s.$message),1))),128))])):c("",!0)]),v.value?(i(),r("div",J,[t("p",Q,[e[6]||(e[6]=m(" Cuenta bloqueada temporalmente. ")),e[7]||(e[7]=t("br",null,null,-1)),m(" Tiempo restante: "+g(q.value),1)])])):c("",!0),t("div",W,[e[8]||(e[8]=t("div",{class:"recaptcha",id:"recaptcha"},null,-1)),p.value?c("",!0):(i(),r("p",X,"Por favor, verifica que no eres un robot."))]),t("button",Z,[a(h).isChecking?(i(),r("div",se,e[9]||(e[9]=[I('<div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div>',6)]))):(i(),r("span",ee,"Iniciar sesión"))]),t("span",te,[e[11]||(e[11]=m("¿Aún no tienes una cuenta? ")),N(d,{class:"text-link",to:{name:"registro"}},{default:F(()=>e[10]||(e[10]=[m("Registrate aquí")])),_:1})])],32)}}};export{ie as default};
