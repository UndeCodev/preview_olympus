import{o as a,a as n,b as s,d as S,C as T,e as I,f as v,g as F,u as N,h as j,i as f,w as h,j as $,v as z,n as C,k as o,F as _,l as M,m as g,p as H,c as V,q as u,t as x,s as D,x as O,r as P,y as U}from"./index-JSM4PwRk.js";import{c as y,r as B,e as K,u as Y}from"./index-a2vJSC8G.js";import{r as G}from"./EyeIcon-ChEsbjiT.js";import{r as J}from"./EyeSlashIcon-AwwwiCn2.js";function Q(q,l){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})])}const W={class:"container mx-auto h-screen grid content-center place-content-center"},X={class:"form-group grid gap-3"},Z={key:0},ee={class:"form-group grid gap-3"},se={for:"password",class:"flex justify-between"},te={class:"password-container"},oe=["type"],ae={key:0},re={key:0},ne={class:"text-center text-error"},ie={class:"recaptcha"},le={key:0,class:"text-error"},de={class:"btn btn-primary"},ue={key:0},ce={key:1,class:"sk-chase w-8 h-8 mx-auto"},pe={class:"grid text-center"},we={__name:"LoginView",setup(q){S(()=>{window.grecaptcha.render("recaptcha",{sitekey:T,"expired-callback":()=>{console.log("Expirado")}})});const l=I({email:"",password:""}),w=v(!0),k=v(!1),c=v(0),p=v(!1),A={email:{required:y.withMessage("Este campo es obligatorio",B),email:y.withMessage("Correo electrónico inválido",K)},password:{required:y.withMessage("Este campo es obligatorio",B)}},r=Y(A,l),b=F.useToast(),m=N(),E=j(()=>{const d=Math.floor(c.value),e=Math.floor(d/60),i=d%60;return`${e}:${i<10?"0"+i:i}`}),L=()=>{const d=setInterval(()=>{c.value>0?c.value--:(clearInterval(d),k.value=!1)},1e3)},R=async()=>{if(r.value.$touch(),r.value.$invalid)return;const d=await grecaptcha.getResponse();if(!d)return w.value=!1;w.value=!0;const{ok:e,message:i,timeRemaining:t}=await m.login(l.email,l.password,d);if(!e){grecaptcha.reset(),t>0&&(c.value=t,k.value=!0,L()),b.open({message:i,type:"error",duration:4e3,pauseOnHover:!0});return}U.replace({name:m.hasMFA?"mfa-verification":"inicio"}),m.hasMFA||b.open({message:"Bienvenido de nuevo 👋🏽👋🏽👋🏽",type:"success",duration:4e3,pauseOnHover:!0})};return(d,e)=>{const i=P("RouterLink");return a(),n("main",W,[f(i,{to:{name:"inicio"},class:"btn btn-outline place-self-start m-8 absolute inset-0 text-slate-800"},{default:h(()=>[f(o(Q),{class:"size-8 text-slate-700"}),e[5]||(e[5]=u(" Ir al inicio "))]),_:1}),s("form",{onSubmit:O(R,["prevent"]),class:"form bg-white rounded-md shadow-md p-6"},[e[15]||(e[15]=s("h1",{class:"text-center text-4xl"},"Iniciar sesión",-1)),s("div",X,[e[6]||(e[6]=s("label",{for:"email"},"Correo electrónico:",-1)),$(s("input",{type:"text",placeholder:"janedoe@outlook.com",class:C(["form-control",{"form-control--error":o(r).email.$error}]),id:"email","onUpdate:modelValue":e[0]||(e[0]=t=>l.email=t),onBlur:e[1]||(e[1]=(...t)=>o(r).email.$touch&&o(r).email.$touch(...t))},null,34),[[z,l.email,void 0,{trim:!0}]]),o(r).email.$error?(a(),n("span",Z,[(a(!0),n(_,null,M(o(r).email.$errors,t=>(a(),n("p",{key:t.$uid,class:"text-error"},x(t.$message),1))),128))])):g("",!0)]),e[16]||(e[16]=s("input",{type:"text",name:"username",autocomplete:"username",style:{display:"none"}},null,-1)),s("div",ee,[s("label",se,[e[8]||(e[8]=s("span",null,"Contraseña: ",-1)),f(i,{class:"text-link",to:{name:"enviar-correo-recuperacion"}},{default:h(()=>e[7]||(e[7]=[u(" ¿Olvidaste tu contraseña? ")])),_:1})]),s("div",te,[$(s("input",{type:p.value?"text":"password",placeholder:"**********",class:C(["form-control",{"form-control--error":o(r).password.$error}]),id:"password","onUpdate:modelValue":e[2]||(e[2]=t=>l.password=t),onBlur:e[3]||(e[3]=(...t)=>o(r).password.$touch&&o(r).password.$touch(...t)),autocomplete:"current-password"},null,42,oe),[[H,l.password]]),s("button",{type:"button",onClick:e[4]||(e[4]=t=>p.value=!p.value),class:"toggle-btn bg-blue-100"},[p.value?(a(),V(o(J),{key:1,class:"icon-password size-8"})):(a(),V(o(G),{key:0,class:"icon-password size-8"}))])]),o(r).password.$error?(a(),n("span",ae,[(a(!0),n(_,null,M(o(r).password.$errors,t=>(a(),n("p",{key:t.$uid,class:"text-error"},x(t.$message),1))),128))])):g("",!0)]),k.value?(a(),n("div",re,[s("p",ne,[e[9]||(e[9]=u(" Cuenta bloqueada temporalmente. ")),e[10]||(e[10]=s("br",null,null,-1)),u(" Tiempo restante: "+x(E.value),1)])])):g("",!0),s("div",ie,[e[11]||(e[11]=s("div",{class:"recaptcha",id:"recaptcha"},null,-1)),w.value?g("",!0):(a(),n("p",le," Por favor, verifica que no eres un robot. "))]),s("button",de,[o(m).isChecking?(a(),n("div",ce,e[12]||(e[12]=[D('<div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div>',6)]))):(a(),n("span",ue,"Iniciar sesión"))]),s("span",pe,[e[14]||(e[14]=u("¿Aún no tienes una cuenta? ")),f(i,{class:"text-link",to:{name:"registro"}},{default:h(()=>e[13]||(e[13]=[u("Registrate aquí")])),_:1})])],32)])}}};export{we as default};
