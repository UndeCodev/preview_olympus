import{_ as U,b as A,d as b,f as V,E as B,e as q,u as F,g as c,h as e,w as f,p as h,n as u,i as r,c as g,F as $,j as _,k as P,t as w,l as R,m as T,T as j,x as H,B as E,o as t,A as Z,z as W}from"./index-CSTKgCyW.js";import{c as p,r as k,s as G,u as J}from"./index-DIE5a-PX.js";import{r as C}from"./EyeIcon-CgvG_yKu.js";import{r as x}from"./EyeSlashIcon-Bq_phEcF.js";const K={class:"h-screen grid place-items-center content-center grid-cols-1"},Q={class:"grid gap-8"},X={class:"form-group"},Y={class:"password-container"},ss=["type"],es={key:0},os={class:"form-group"},as={class:"password-container"},rs=["type"],ts={key:0},ns={class:"text-error"},ls={key:1},ds={class:"strength-meter mb-8"},is={class:"form-group"},cs={class:"password-container"},us=["type"],ws={key:0},ps=["disabled"],ms={__name:"ChangePasswordPage",setup(gs){const N=p.regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_])[A-Za-z\d\W_]{12,}$/),z=()=>({oldPassword:"",newPassword:"",confirmNewPassord:""}),a=A(z()),i=A({oldPassword:!1,newPassword:!1,confirmNewPassord:!1}),l=b({lowercaseUppercase:!1,number:!1,specialChar:!1,minLength:!1}),v=b(""),I=b(0),L={oldPassword:{$autoDirty:!0,required:p.withMessage("Este campo es obligatorio",k)},newPassword:{$autoDirty:!0,required:p.withMessage("Este campo es obligatorio",k),password:p.withMessage("Por favor agrega todos los carácteres necesarios.",N)},confirmNewPassord:{$autoDirty:!0,required:p.withMessage("Este campo es obligatorio",k),password:p.withMessage("El campo no cumple con los requisitos.",N),sameAs:p.withMessage("Las contraseñas no coinciden",G(V(()=>a.newPassword)))}},m=B("inputOldPassword"),n=J(L,a),y=q.useToast(),M=F(),D=()=>{const d=a.newPassword;l.value.lowercaseUppercase=/[a-z]/.test(d)&&/[A-Z]/.test(d),l.value.number=/\d/.test(d),l.value.specialChar=/[!@#$%^&*]/.test(d),l.value.minLength=d.length>=12;const s=Object.values(l.value).filter(Boolean).length;I.value=s/4*100},O=async()=>{if(!(!a.newPassword||n.value.newPassword.$error))try{const d=await E.post("/auth/check-pswd",{password:a.newPassword});console.log(d);const s=d.data==="Comprometida";v.value=s?"Contraseña comprometida, por favor utiliza otra.":""}catch(d){console.error("Error verificando la contraseña:",d),v.value="Error verificando la contraseña"}},S=async d=>{if(n.value.$touch(),!n.value.$invalid){if(a.oldPassword===a.newPassword){y.open({message:"No puedes colocar tu contraseña antigua como nueva, intenta con otra.",type:"warning",duration:4e3,pauseOnHover:!0}),m.value.focus(),m.value.classList.add("form-control--error");return}m.value.classList.remove("form-control--error");try{const{status:s,data:o}=await E.put("/auth/change-password",{email:M.email,oldPassword:a.oldPassword,newPassword:a.newPassword});if(s!==200)return;y.open({message:o.message,type:"success",duration:4e3,pauseOnHover:!0}),d.target.reset(),Object.assign(a,z())}catch(s){const o=s.response.data.message;y.open({message:o,type:"error",duration:4e3,pauseOnHover:!0}),s.status===401&&(m.value.focus(),m.value.classList.add("form-control--error"))}}};return(d,s)=>(t(),c("div",K,[e("form",{onSubmit:s[6]||(s[6]=H(o=>S(o),["prevent"])),class:"bg-white shadow rounded p-8 grid gap-12 md:w-1/2 lg:w-1/2 xl:w-1/3 mx-auto"},[s[11]||(s[11]=e("div",null,[e("h1",{class:"text-5xl mb-4"},"Cambiar contraseña"),e("p",null,' Introduce tu contraseña actual y elige una nueva. Asegúrate de que sea segura, combinando letras, números y símbolos. Confirma la nueva contraseña y haz clic en "Cambiar contraseña" para aplicar los cambios. ')],-1)),e("div",Q,[e("div",X,[s[7]||(s[7]=e("label",{for:"old-password"},"Contraseña actual:",-1)),s[8]||(s[8]=e("input",{type:"text",name:"username",autocomplete:"username",style:{display:"none"}},null,-1)),e("div",Y,[f(e("input",{type:i.oldPassword?"text":"password",class:u(["form-control",{"form-control--error":r(n).oldPassword.$error}]),placeholder:"Ingresa tu contraseña actual",id:"oldPassword","onUpdate:modelValue":s[0]||(s[0]=o=>a.oldPassword=o),ref_key:"inputOldPassword",ref:m,autocomplete:"current-password"},null,10,ss),[[h,a.oldPassword,void 0,{trim:!0}]]),e("button",{type:"button",onClick:s[1]||(s[1]=o=>i.oldPassword=!i.oldPassword),class:"toggle-btn bg-blue-100"},[i.oldPassword?(t(),g(r(x),{key:1,class:"icon-password size-8"})):(t(),g(r(C),{key:0,class:"icon-password size-8"}))])]),r(n).oldPassword.$error?(t(),c("span",es,[(t(!0),c($,null,_(r(n).oldPassword.$errors,o=>(t(),c("p",{key:o.$uid,class:"text-error"},w(o.$message),1))),128))])):P("",!0)]),e("div",os,[s[9]||(s[9]=e("label",{for:"new-password"},"Contraseña nueva:",-1)),e("div",as,[f(e("input",{type:i.newPassword?"text":"password",class:u(["form-control",{"form-control--error":r(n).newPassword.$error}]),placeholder:"Ingresa tu nueva contraseña",id:"new-password","onUpdate:modelValue":s[2]||(s[2]=o=>a.newPassword=o),onInput:D,onBlur:O,autocomplete:"new-password"},null,42,rs),[[h,a.newPassword,void 0,{trim:!0}]]),e("button",{type:"button",onClick:s[3]||(s[3]=o=>i.newPassword=!i.newPassword),class:"toggle-btn bg-blue-100"},[i.newPassword?(t(),g(r(x),{key:1,class:"icon-password size-8"})):(t(),g(r(C),{key:0,class:"icon-password size-8"}))])]),v.value.length?(t(),c("span",ts,[e("p",ns,w(v.value),1)])):P("",!0),r(n).newPassword.$error?(t(),c("span",ls,[(t(!0),c($,null,_(r(n).newPassword.$errors,o=>(t(),c("p",{key:o.$uid,class:"text-error"},w(o.$message),1))),128))])):P("",!0),R(j,null,{default:T(()=>[f(e("div",null,[e("div",ds,[e("div",{class:"strength-meter-fill",style:W({width:I.value+"%"})},null,4)]),e("ul",null,[e("li",{class:u({passed:l.value.lowercaseUppercase})},w(l.value.lowercaseUppercase?"✔":"✖️")+" Incluye mayúsculas y minúsculas ",3),e("li",{class:u({passed:l.value.number})},w(l.value.number?"✔":"✖️")+" Incluye un número ",3),e("li",{class:u({passed:l.value.specialChar})},w(l.value.specialChar?"✔":"✖️")+" Incluye un carácter especial (!@#$%^&*) ",3),e("li",{class:u({passed:l.value.minLength})},w(l.value.minLength?"✔":"✖️")+" Debe contener al menos 12 carácteres ",3)])],512),[[Z,a.newPassword]])]),_:1})]),e("div",is,[s[10]||(s[10]=e("label",{for:"confirm-password"},"Confirmar contraseña:",-1)),e("div",cs,[f(e("input",{type:i.confirmNewPassord?"text":"password",class:u(["form-control",{"form-control--error":r(n).confirmNewPassord.$error}]),placeholder:"Reingresa tu nueva contraseña",id:"confirm-password","onUpdate:modelValue":s[4]||(s[4]=o=>a.confirmNewPassord=o),autocomplete:"new-password"},null,10,us),[[h,a.confirmNewPassord,void 0,{trim:!0}]]),e("button",{type:"button",onClick:s[5]||(s[5]=o=>i.confirmNewPassord=!i.confirmNewPassord),class:"toggle-btn bg-blue-100"},[i.confirmNewPassord?(t(),g(r(x),{key:1,class:"icon-password size-8"})):(t(),g(r(C),{key:0,class:"icon-password size-8"}))])]),r(n).confirmNewPassord.$error?(t(),c("span",ws,[(t(!0),c($,null,_(r(n).confirmNewPassord.$errors,o=>(t(),c("p",{key:o.$uid,class:"text-error"},w(o.$message),1))),128))])):P("",!0)])]),e("button",{type:"submit",class:u(["btn btn-primary",{"btn-primary--disabled":r(n).$invalid}]),disabled:r(n).$invalid}," Cambiar contraseña ",10,ps)],32)]))}},bs=U(ms,[["__scopeId","data-v-442fe400"]]);export{bs as default};
