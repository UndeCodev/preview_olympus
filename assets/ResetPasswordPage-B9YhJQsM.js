import{f as u,e as R,h as F,g as G,d as T,y as z,a as l,b as e,m as b,j as k,p as M,n as d,k as i,c as h,F as S,l as I,i as W,w as Z,T as j,s as H,x as Y,G as J,B as P,o,t as p,A as K,z as Q}from"./index-JSM4PwRk.js";import{c as m,r as V,s as X,u as ss}from"./index-a2vJSC8G.js";import{r as A}from"./EyeIcon-ChEsbjiT.js";import{r as q}from"./EyeSlashIcon-AwwwiCn2.js";const es={class:"h-screen grid place-items-center"},as={class:"form-information mb-3"},os=["src"],ts={class:"form-group"},rs={class:"password-container"},ns=["type"],ls={key:0},is={class:"strength-meter mb-8"},cs={class:"form-group"},us={class:"password-container"},ds=["type"],ps={key:0},ms={type:"submit",class:"btn btn-primary mt-3"},ws={key:0},vs={key:1,class:"sk-chase w-8 h-8 mx-auto"},ks={__name:"ResetPasswordPage",setup(gs){const B=m.regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_])[A-Za-z\d\W_]{12,}$/),w=u(""),v=u(!1),n=R({newPassword:"",confirmPassword:""}),t=u({lowercaseUppercase:!1,number:!1,specialChar:!1,minLength:!1}),_=u(""),$=u(0),g=u(!1),f=u(!1),D={newPassword:{$autoDirty:!0,required:m.withMessage("Este campo es obligatorio",V),password:m.withMessage("Por favor agrega todos los carácteres necesarios.",B)},confirmPassword:{$autoDirty:!0,required:m.withMessage("Este campo es obligatorio",V),sameAs:m.withMessage("Las contraseñas no coinciden",X(F(()=>n.newPassword)))}},c=ss(D,n),C=G.useToast(),x=J(),L=document.querySelector("link[rel~='icon']"),y=u(""),U=()=>{const a=n.newPassword;t.value.lowercaseUppercase=/[a-z]/.test(a)&&/[A-Z]/.test(a),t.value.number=/\d/.test(a),t.value.specialChar=/[!@#$%^&*]/.test(a),t.value.minLength=a.length>=12;const s=Object.values(t.value).filter(Boolean).length;$.value=s/4*100},E=async()=>{if(!(!n.newPassword||c.value.newPassword.$error))try{const s=(await P.post("/auth/check-pswd",{password:n.newPassword})).data==="Comprometida";_.value=s?"Contraseña comprometida, por favor utiliza otra.":""}catch(a){console.error("Error verificando la contraseña:",a),_.value="Error verificando la contraseña"}},N=async()=>{if(c.value.$touch(),!c.value.$invalid)try{v.value=!0;const{status:a,data:s}=await P.put("/auth/reset-password",{newPassword:n.newPassword},{params:{token:w.value}});if(a!==200)return;C.open({message:s.message,type:"success",duration:4e3,pauseOnHover:!0}),v.value=!1,z.replace({name:"inicio-sesion"})}catch(a){console.log(a);const s=a.response.data.message;C.open({message:s,type:"error",duration:4e3,pauseOnHover:!0}),v.value=!1}},O=async()=>{try{const{data:a}=await P.get("/settings/company-profile"),{thumbnail_logo_url:s,page_title:r}=a;L.href=s,document.title=r??"Olympus GYM",y.value=s}catch(a){console.log(a)}};return T(async()=>{var a;if(await O(),(a=x.query)!=null&&a.token&&(w.value=x.query.token.toString()),!w.value||w.value.length<20)return z.replace("inicio-sesion")}),(a,s)=>(o(),l("div",es,[e("form",{onSubmit:Y(N,["prevent"]),class:"grid gap-6 bg-white shadow p-8 rounded-sm md:w-1/2 lg:w-1/4 mx-8"},[e("div",as,[y.value?(o(),l("img",{key:0,src:y.value,alt:"Logo Olympus GYM",class:"size-40 bg-slate-900 rounded-full mb-6"},null,8,os)):b("",!0),s[4]||(s[4]=e("h1",{class:"text-3xl font-semibold mb-3 text-slate-900"},"Crea una contraseña nueva",-1)),s[5]||(s[5]=e("p",{class:"text-slate-600"}," Ingresa una nueva contraseña para tu cuenta. Asegúrate de que sea segura y fácil de recordar. ",-1))]),e("div",ts,[s[6]||(s[6]=e("label",{for:"password"},"Contraseña nueva:",-1)),e("div",rs,[k(e("input",{type:g.value?"text":"password",class:d([{"form-control--error":i(c).newPassword.$error},"form-control"]),placeholder:"Introduce tu nueva contraseña","onUpdate:modelValue":s[0]||(s[0]=r=>n.newPassword=r),onInput:U,onBlur:E,autocomplete:"new-password"},null,42,ns),[[M,n.newPassword,void 0,{trim:!0}]]),e("button",{type:"button",onClick:s[1]||(s[1]=r=>g.value=!g.value),class:"toggle-btn bg-blue-100"},[g.value?(o(),h(i(q),{key:1,class:"icon-password size-8"})):(o(),h(i(A),{key:0,class:"icon-password size-8"}))])]),i(c).newPassword.$error?(o(),l("span",ls,[(o(!0),l(S,null,I(i(c).newPassword.$errors,r=>(o(),l("p",{key:r.$uid,class:"text-error"},p(r.$message),1))),128))])):b("",!0),W(j,null,{default:Z(()=>[k(e("div",null,[e("div",is,[e("div",{class:"strength-meter-fill",style:Q({width:$.value+"%"})},null,4)]),e("ul",null,[e("li",{class:d({passed:t.value.lowercaseUppercase})},p(t.value.lowercaseUppercase?"✔":"✖️")+" Incluye mayúsculas y minúsculas ",3),e("li",{class:d({passed:t.value.number})},p(t.value.number?"✔":"✖️")+" Incluye un número ",3),e("li",{class:d({passed:t.value.specialChar})},p(t.value.specialChar?"✔":"✖️")+" Incluye un carácter especial (!@#$%^&*) ",3),e("li",{class:d({passed:t.value.minLength})},p(t.value.minLength?"✔":"✖️")+" Debe contener al menos 12 carácteres ",3)])],512),[[K,n.newPassword]])]),_:1})]),e("div",cs,[s[7]||(s[7]=e("label",{for:"password"},"Confirma tu contraseña:",-1)),e("div",us,[k(e("input",{type:f.value?"text":"password",class:d([{"form-control--error":i(c).confirmPassword.$error},"form-control"]),placeholder:"Confirma tu contraseña","onUpdate:modelValue":s[2]||(s[2]=r=>n.confirmPassword=r),autocomplete:"new-password"},null,10,ds),[[M,n.confirmPassword,void 0,{trim:!0}]]),e("button",{type:"button",onClick:s[3]||(s[3]=r=>f.value=!f.value),class:"toggle-btn bg-blue-100"},[f.value?(o(),h(i(q),{key:1,class:"icon-password size-8"})):(o(),h(i(A),{key:0,class:"icon-password size-8"}))])]),i(c).confirmPassword.$error?(o(),l("span",ps,[(o(!0),l(S,null,I(i(c).confirmPassword.$errors,r=>(o(),l("p",{key:r.$uid,class:"text-error"},p(r.$message),1))),128))])):b("",!0)]),e("button",ms,[v.value?(o(),l("div",vs,s[8]||(s[8]=[H('<div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div>',6)]))):(o(),l("span",ws," Cambiar contraseña "))])],32)]))}};export{ks as default};
